<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="./style.css" />
  </head>
  <body>
    <table id="mytable" class="table">
      <thead>
        <tr>
          <th scope="col">Country</th>
          <th scope="col">State</th>
          <th scope="col">Action</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <!-- req libraries start -->
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js"
      integrity="sha512-3gJwYpMe3QewGELv8k/BX9vcqhryRdzRMxVfq6ngyWXwo03GFEzjsUm8Q7RZcHPHksttq7/GFoxjCVUjkjvPdw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
      integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.21/js/jquery.dataTables.min.js"
      integrity="sha512-BkpSL20WETFylMrcirBahHfSnY++H2O1W+UnEEO4yNIl+jI2+zowyoGJpbtk6bx97fBXf++WJHSSK2MV4ghPcg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <!-- req libraries start -->

    <!-- script -->
    <script>
      $(document).ready(async function () {
        let rows = await fetchData("./onlycountrystates.json");
        $("#mytable").DataTable({
          data: rows,
          columns: [
            {
              data: "cName",
            },
            {
              data: "sName",
            },
            {
              data: "",
              render: function (d) {
                return '<i class="fa-solid fa-plus expandState"></i>';
              },
            },
          ],
        });
      });

      //fetch method to get data by url
      async function fetchData(url) {
        let rows = [];
        await fetch(url)
          .then((r) => r.json())
          .then((r) => {
            rows = r;
          });
        return rows;
      }

      //  create the nested table ...
      async function buildExpandTable(nesteddata) {
        let table =
          '<div class="expand"><table id="mytable" class="table">' +
          "<thead>" +
          "<tr>" +
          '<th scope="col">State</th>' +
          '<th scope="col">City</th>' +
          '<th scope="col">Action</th>' +
          "</tr>" +
          "</thead>" +
          "<tbody>";

        await nesteddata.cities.forEach((r) => {
          let tr = "<tr>";
          tr += "<td>" + nesteddata.sName + "</td>";
          tr += "<td>" + r.name + "</td>";
          tr += '<td><i class="fa-solid fa-plus expandCity"></i></td>';
          tr += "</tr>";
          table += tr;
        });
        table += "</tbody></table></div>";
        return table;
      }
      // create the second nested table
      async function buildExpandTable1(nesteddata) {
        let table =
          '<div class="expand1"><table id="mytable1" class="table">' +
          "<thead>" +
          "<tr>" +
          '<th scope="col">State</th>' +
          '<th scope="col">City</th>' +
          "</tr>" +
          "</thead>" +
          "<tbody>";

        await nesteddata.cities.forEach((r) => {
          let tr = "<tr>";
          tr += "<td>" + nesteddata.sName + "</td>";
          tr += "<td>" + r.name + "</td>";
          tr += "</tr>";
          table += tr;
        });
        table += "</tbody></table></div>";
        return table;
      }

      $(document).on("click", ".expandState", async function () {
        debugger;
        if ($(this).hasClass("fa-plus")) {
          //clearing old expands...if exist. start
          $(".expand").remove();
          document.querySelectorAll(".expandState").forEach((ic) => {
            $(ic).removeClass("fa-minus").addClass("fa-plus");
          });
          // end

          $(this).removeClass("fa-plus").addClass("fa-minus");

          // fetch nested table data from backend..
          let state = await fetchData("./singlestate.json");
          // get nested table by passing data
          let exTable = await buildExpandTable(state);

          $(this).parent().parent().after(exTable);
          $(".expand").toggleClass("expand-active");
        } else {
          $(this).removeClass("fa-minus").addClass("fa-plus");
          $(".expand").remove();
        }
      });

      //nested expand
      $(document).on("click", ".expandCity", async function () {
        if ($(this).hasClass("fa-plus")) {
          //clearing old expands...if exist. start
          $(".expand1").remove();
          document.querySelectorAll(".expandCity").forEach((ic) => {
            $(ic).removeClass("fa-minus").addClass("fa-plus");
          });
          // end

          $(this).removeClass("fa-plus").addClass("fa-minus");

          // fetch nested table data from backend..
          let state = await fetchData("./singlestate.json");
          // get nested table by passing data
          let exTable = await buildExpandTable1(state);

          $(this).parent().parent().after(exTable);
          $(".expand1").toggleClass("expand-active");
        } else {
          $(this).removeClass("fa-minus").addClass("fa-plus");
          $(".expand1").remove();
        }
      });
    </script>
  </body>
</html>
